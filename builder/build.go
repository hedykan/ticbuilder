package builder

import (
	"fmt"
	"io"
	"os"
)

var headBytes = []byte{
	17, 0, 0, 0, 1, 160, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 206, 204, 204, 204, 204, 136, 136, 136,
	172, 170, 170, 170, 172, 136, 136, 136, 172, 204, 204, 204, 172, 204, 192, 204,
	172, 204, 192, 204, 172, 204, 192, 204, 204, 204, 236, 238, 136, 136, 204, 238,
	170, 170, 192, 238, 136, 168, 192, 238, 204, 172, 192, 204, 192, 172, 192, 192,
	192, 172, 192, 192, 192, 172, 192, 192, 206, 204, 204, 204, 204, 136, 136, 136,
	172, 170, 170, 170, 172, 136, 136, 136, 172, 204, 204, 204, 172, 204, 204, 204,
	172, 204, 192, 204, 172, 204, 192, 204, 204, 204, 236, 238, 136, 136, 204, 238,
	170, 170, 192, 238, 136, 168, 192, 238, 204, 172, 192, 204, 204, 172, 192, 192,
	192, 172, 192, 192, 192, 172, 192, 192, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 172, 204, 204, 204, 172, 170, 170, 170,
	172, 170, 172, 170, 172, 170, 202, 204, 172, 170, 170, 170, 140, 136, 136, 136,
	204, 0, 192, 204, 206, 204, 204, 206, 204, 172, 0, 204, 170, 170, 192, 236,
	172, 170, 192, 238, 170, 170, 192, 238, 170, 170, 192, 238, 136, 136, 204, 238,
	0, 192, 236, 238, 204, 204, 238, 238, 172, 204, 204, 204, 172, 170, 170, 170,
	172, 170, 172, 170, 172, 170, 202, 204, 172, 170, 170, 170, 140, 136, 136, 136,
	204, 0, 192, 204, 206, 204, 204, 206, 204, 172, 0, 204, 170, 170, 192, 236,
	172, 170, 192, 238, 170, 170, 192, 238, 170, 170, 192, 238, 136, 136, 204, 238,
	0, 192, 236, 238, 204, 204, 238, 238, 9, 62, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 0, 0, 0, 0, 0, 0, 0, 3, 4, 14, 1, 0, 0, 1, 5,
	226, 4, 0,
}

func Build(inputSrcArr []string, outputSrc string) {
	times := 0x2f3

	out, err := os.OpenFile(outputSrc, os.O_TRUNC|os.O_CREATE, 0644)
	if err != nil {
		panic(err.Error())
	}
	defer out.Close()

	out.Write(headBytes[:times])

	for _, inputSrc := range inputSrcArr {
		src, err := os.Open(inputSrc)
		if err != nil {
			panic(err.Error())
		}
		defer src.Close()

		srcBytes, err := io.ReadAll(src)
		srcBytes = append(srcBytes, '\n')
		fmt.Println(string(srcBytes))
		out.Write(srcBytes)
	}
}

// 验证卡带存储方式
func check(ticCartName string) {
	mygame, _ := os.Open(ticCartName)
	srcBytes, _ := io.ReadAll(mygame)
	times := 0x2f3

	for i := 0; i < times; i++ {
		if srcBytes[i] != headBytes[i] {
			fmt.Printf("%x ", i)
			fmt.Println("src:", srcBytes[i], "head:", headBytes[i])
		} else {
			// fmt.Println("ok")
		}
	}

	return
}
